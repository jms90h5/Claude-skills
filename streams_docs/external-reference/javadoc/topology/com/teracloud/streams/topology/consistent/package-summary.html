<!DOCTYPE HTML>
<html lang="en">
<head>
<!-- Generated by javadoc (17) -->
<title>com.teracloud.streams.topology.consistent (Java Application API for Streams)</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<meta name="description" content="declaration: package: com.teracloud.streams.topology.consistent">
<meta name="generator" content="javadoc/PackageWriterImpl">
<link rel="stylesheet" type="text/css" href="../../../../../stylesheet.css" title="Style">
<link rel="stylesheet" type="text/css" href="../../../../../script-dir/jquery-ui.min.css" title="Style">
<link rel="stylesheet" type="text/css" href="../../../../../jquery-ui.overrides.css" title="Style">
<script type="text/javascript" src="../../../../../script.js"></script>
<script type="text/javascript" src="../../../../../script-dir/jquery-3.7.1.min.js"></script>
<script type="text/javascript" src="../../../../../script-dir/jquery-ui.min.js"></script>
</head>
<body class="package-declaration-page">
<script type="text/javascript">var evenRowColor = "even-row-color";
var oddRowColor = "odd-row-color";
var tableTab = "table-tab";
var activeTableTab = "active-table-tab";
var pathtoroot = "../../../../../";
loadScripts(document, 'script');</script>
<noscript>
<div>JavaScript is disabled on your browser.</div>
</noscript>
<div class="flex-box">
<header role="banner" class="flex-header">
<nav role="navigation">
<!-- ========= START OF TOP NAVBAR ======= -->
<div class="top-nav" id="navbar-top">
<div class="skip-nav"><a href="#skip-navbar-top" title="Skip navigation links">Skip navigation links</a></div>
<ul id="navbar-top-firstrow" class="nav-list" title="Navigation">
<li><a href="../../../../../index.html">Overview</a></li>
<li class="nav-bar-cell1-rev">Package</li>
<li>Class</li>
<li><a href="package-tree.html">Tree</a></li>
<li><a href="../../../../../deprecated-list.html">Deprecated</a></li>
<li><a href="../../../../../index-all.html">Index</a></li>
<li><a href="../../../../../help-doc.html#package">Help</a></li>
</ul>
</div>
<div class="sub-nav">
<div>
<ul class="sub-nav-list">
<li>Package:&nbsp;</li>
<li><a href="#package-description">Description</a>&nbsp;|&nbsp;</li>
<li><a href="#related-package-summary">Related Packages</a>&nbsp;|&nbsp;</li>
<li><a href="#class-summary">Classes and Interfaces</a></li>
</ul>
</div>
<div class="nav-list-search"><label for="search-input">SEARCH:</label>
<input type="text" id="search-input" value="search" disabled="disabled">
<input type="reset" id="reset-button" value="reset" disabled="disabled">
</div>
</div>
<!-- ========= END OF TOP NAVBAR ========= -->
<span class="skip-nav" id="skip-navbar-top"></span></nav>
</header>
<div class="flex-content">
<main role="main">
<div class="header">
<h1 title="Package com.teracloud.streams.topology.consistent" class="title">Package com.teracloud.streams.topology.consistent</h1>
</div>
<hr>
<div class="package-signature">package <span class="element-name">com.teracloud.streams.topology.consistent</span></div>
<section class="package-description" id="package-description">
<div class="block">At least once processing using consistent regions.
 
 <H2>Consistent regions</H2>
 
 <H3>Overview</H3>
 
 Because of business requirements, some applications require that all tuples
 in an application are processed at least once. You can use a consistent
 region in your streams processing applications to avoid data loss due to
 software or hardware failure and meet your requirements for at-least-once
 processing.
 <P>
 A consistent region is a subgraph where the states region (the operators
 and transformations within it) become
 consistent by processing all the tuples within defined
 points on a stream. This enables tuples within the subgraph to be processed
 at least once. The consistent region is periodically drained of its current
 tuples. All tuples in the consistent region are processed through to the end
 of the subgraph. In-memory state of operators are automatically serialized
 and stored on checkpoint for each of the operators in the region.
 </P>
 <P>
 If any element in a consistent region fails at run time, Streams detects
 the failure and triggers the restart of the element and the reset of the
 region. In-memory state of the region is automatically reloaded to
 a consistent point.
 </P>
 <P>
 The capability to drain the subgraph, which is coupled with start operators
 that can replay their output streams, enables a consistent region to achieve
 at-least-once processing.
 </P>
 <P>
 A stream processing application can be defined with zero, one, or more
 consistent regions. You can define the start of a consistent region with
 the <a href="../TStream.html#setConsistent(com.teracloud.streams.topology.consistent.ConsistentRegionConfig)"><code>setConsistent()</code></a>.}.
 Streams then determines
 the scope of the consistent region automatically, but you can reduce the
 scope of the region with <a href="../TStream.html#autonomous()"><code>TStream.autonomous()</code></a>.
 </P>
 <P>
 When a subgraph is a consistent region, Streams enables the
 operators in that region to drain and reset. When a region is draining, it
 establishes logical divisions in the output streams of each operator in the
 region. A drain is successful when all operators in the region establish a
 logical division in their output streams, and when all tuples before the
 logical division are processed in their input streams. If a drain is
 successful, it means that all operators in the region consumed all input
 streams up until the established logical division. While the region is
 draining or resetting, operators in the region that completed their draining
 or resetting cannot submit new tuples. This behavior means that the tuple
 flow within the subgraph briefly stops while the region is draining or resetting.
 </P>
 
 <H3>Start of a consistent region</H3>
 A consistent region is started by marking a source stream as consistent using
 <a href="../TStream.html#setConsistent(com.teracloud.streams.topology.consistent.ConsistentRegionConfig)"><code>TStream.setConsistent(ConsistentRegionConfig)</code></a>.
 The operator that is the source of the <code>TStream</code> must support logic that,
 after a failure in the region, can replay tuples since the last checkpoint.
 Typically the stream is a source stream that produces tuples from an external system
 like Apache Kakfa.
 <P>
 The logic that produces a replayable stream must be implemented
 using Streams Java or C++ primitive operator apis.
 <BR>
 A functional source
 (e.g. <a href="../Topology.html#source(com.teracloud.streams.topology.function.Supplier)"><code>Topology.source(com.teracloud.streams.topology.function.Supplier)</code></a>)
 cannot be used as the start of a consistent region,
 thus the stream must be from an invocation of an SPL operator through
 <a href="../spl/SPL.html" title="class in com.teracloud.streams.topology.spl"><code>SPL</code></a>, 
 <a href="../spl/JavaPrimitive.html" title="class in com.teracloud.streams.topology.spl"><code>JavaPrimitive</code></a>.
 Such an invocation may be wrapped by a Java method that provides
 a simplified version of the invocation for application developers.
 </P>
 
 <H3>Drain-checkpoint cycle</H3>
 When a region is triggered it is:
 <OL>
 <LI> <em>drained</em> of any tuple related processing for
 all tuples seen on each stream in the region</li>
 <LI> <em>checkpointed</em> to reflect the state of each tuple processor (operator)
 after it has processed all tuples on its input streams (it has been <em>drained</em>).
 </OL>
 This drain-checkpoint cycle results in a region where all the operators are
 consistent with having processed all tuples seen on their input streams, and the
 region as a whole is consistent with having processed all tuples the source operator
 has submitted.
 <P>
 After any failure in the region, all operators are reset to a previous consistent point
 and then tuple processing resumes with the source operator replaying tuples since
 the last consistent point.
 </P>
 <H3>At least once/exactly once processing</H3> 
 From the point of view of an operator in the region tuple processing is effectively exactly
 once even though tuples are replayed after a failure. This is because the consistent
 region protocol resets each operator's state to a point before the tuples were seen for
 the first time. Each operator forgets it has seen the replayed tuple thus it seems them
 effectively exactly once from an operator state point of view.
 <P>
 At least once processing is only seen when the operator modifies external state that cannot
 be undone during a reset. For example sending an SMS text cannot be undone, so a Streams
 application using a consistent region for monitoring and sending text alerts could result
 in more than once text message indicating an issue.
 <BR>
 With coordination between the operator and the external system exactly once processing
 is possible, depending on the capabilities of the external system, for example exactly
 once can be achieved with database and file systems.
 </P>
 <H3>Functional logic in consistent regions</H3>
 
 The checkpointing of functional logic is identical for
 consistent regions and
 <a href="../Topology.html#checkpointPeriod(long,java.util.concurrent.TimeUnit)"><code>autonomous checkpointing</code></a>.
 
 <H4>Stateless functions</H4>
 Stateless functions can be used in a consistent region, e.g. a stateless filter
 like <code>t = t.filter(s -&gt; !s.empty())</code> on a <code>TStream&lt;String&gt;</code>.
 During a drain-checkpoint cycle no processing occurs related to the stateless function.
  
 <H4>Stateful functions</H4>
 Stateful functions can be used in a consistent region. During a drain-checkpoint cycle
 the function instance will be serialized as the checkpointed state.
 
 <H3>Autonomous regions</H3>
 By default processing occurs in an autonomous region where
 operator checkpointing and recovery from failure is
 independent of other operators. A consistent region can be
 ended by starting an autonomous region using
 <a href="../TStream.html#autonomous()"><code>TStream.autonomous()</code></a>.
 Any processing against the stream returned by <code>autonomous()</code>
 is outside of the consistent region.</div>
</section>
<section class="summary">
<ul class="summary-list">
<li>
<div id="related-package-summary">
<div class="caption"><span>Related Packages</span></div>
<div class="summary-table two-column-summary">
<div class="table-header col-first">Package</div>
<div class="table-header col-last">Description</div>
<div class="col-first even-row-color"><a href="../package-summary.html">com.teracloud.streams.topology</a></div>
<div class="col-last even-row-color">
<div class="block">Java application API for Streams.</div>
</div>
</div>
</div>
</li>
<li>
<div id="class-summary">
<div class="table-tabs" role="tablist" aria-orientation="horizontal"><button id="class-summary-tab0" role="tab" aria-selected="true" aria-controls="class-summary.tabpanel" tabindex="0" onkeydown="switchTab(event)" onclick="show('class-summary', 'class-summary', 2)" class="active-table-tab">All Classes and Interfaces</button><button id="class-summary-tab2" role="tab" aria-selected="false" aria-controls="class-summary.tabpanel" tabindex="-1" onkeydown="switchTab(event)" onclick="show('class-summary', 'class-summary-tab2', 2)" class="table-tab">Classes</button><button id="class-summary-tab3" role="tab" aria-selected="false" aria-controls="class-summary.tabpanel" tabindex="-1" onkeydown="switchTab(event)" onclick="show('class-summary', 'class-summary-tab3', 2)" class="table-tab">Enum Classes</button></div>
<div id="class-summary.tabpanel" role="tabpanel" aria-labelledby="class-summary-tab0">
<div class="summary-table two-column-summary">
<div class="table-header col-first">Class</div>
<div class="table-header col-last">Description</div>
<div class="col-first even-row-color class-summary class-summary-tab2"><a href="ConsistentRegionConfig.html" title="class in com.teracloud.streams.topology.consistent">ConsistentRegionConfig</a></div>
<div class="col-last even-row-color class-summary class-summary-tab2">
<div class="block">Immutable consistent region configuration.</div>
</div>
<div class="col-first odd-row-color class-summary class-summary-tab3"><a href="ConsistentRegionConfig.Trigger.html" title="enum class in com.teracloud.streams.topology.consistent">ConsistentRegionConfig.Trigger</a></div>
<div class="col-last odd-row-color class-summary class-summary-tab3">
<div class="block">Defines how the drain-checkpoint cycle of a consistent region is triggered.</div>
</div>
</div>
</div>
</div>
</li>
</ul>
</section>
</main>
</div>
</div>
</body>
</html>
