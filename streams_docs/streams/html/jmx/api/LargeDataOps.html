<?xml version="1.0" encoding="UTF-8"?>
<!-- begin_generated_IBM_Teracloud_ApS_copyright_prolog               -->
<!--                                                                  -->
<!-- This is an automatically generated copyright prolog.             -->
<!-- After initializing,  DO NOT MODIFY OR MOVE                       -->
<!-- **************************************************************** -->
<!-- Licensed Materials - Property of IBM                             -->
<!-- (C) Copyright Teracloud ApS 2025, 2025, IBM Corp. 2018, 2019     -->
<!-- All Rights Reserved.                                             -->
<!-- US Government Users Restricted Rights - Use, duplication or      -->
<!-- disclosure restricted by GSA ADP Schedule Contract with          -->
<!-- IBM Corp.                                                        -->
<!--                                                                  -->
<!-- end_generated_IBM_Teracloud_ApS_copyright_prolog                 -->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<!-- saved from url=(0112)https://www.ibm.com/support/knowledgecenter/SSCRJU_4.3.0/com.ibm.streams.dev.doc/doc/jmxapi-lgop.html?view=embed -->
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-us" lang="en-us">
<head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">

<meta name="security" content="public">
<meta name="Robots" content="index,follow">
<meta name="DC.Type" content="task">
<meta name="DC.Title" content="Performing large data operations with JMX APIs">
<meta name="abstract" content="The Teracloud Streams JMX API uses an HTTPS implementation for transferring large data values between the client where the application runs and the server where the JMX service runs. For example, this implementation is used for client retrieval of processing element (PE) metrics and for uploading an application when a job is submitted.">
<meta name="Description" content="The Teracloud Streams JMX API uses an HTTPS implementation for transferring large data values between the client where the application runs and the server where the JMX service runs. For example, this implementation is used for client retrieval of processing element (PE) metrics and for uploading an application when a job is submitted.">
<meta name="DC.subject" content="APIs, JMX, developing applications, application programming interfaces, applications, developing, JMX API">
<meta name="keywords" content="APIs, JMX, developing applications, application programming interfaces, applications, developing, JMX API">
<meta name="DC.Relation" scheme="URI" content="../doc/jmxapi-dev.html">
<meta name="copyright" content="© Copyright IBM Corporation 2012, 2018">
<meta name="DC.Rights.Owner" content="© Copyright IBM Corporation 2012, 2018">
<meta name="DC.Date" scheme="iso8601" content="2018-07-07">
<meta name="DC.Format" content="XHTML">
<meta name="DC.Identifier" content="jmxapi-lgop">
<meta name="DC.Language" content="en-us">
<meta name="IBM.Country" content="ZZ">
<!-- Licensed Materials - Property of IBM -->
<!-- US Government Users Restricted Rights -->
<!-- Use, duplication or disclosure restricted by -->
<!-- GSA ADP Schedule Contract with IBM Corp. -->

<link rel="stylesheet" type="text/css" href="/streams/html/css/jmx.css" />
<link rel="stylesheet" type="text/css" href="/streams/html/css/swg_info_common.css" />

<title>Performing large data operations with JMX APIs</title>

	 <link rel="shortcut icon" href="/streams/html/images/favicon_16.ico" type="image/vnd.microsoft.icon">
	 <link rel="icon" type="image/png" href="/streams/html/images/favicon-light.png">

<link type="text/css" href="/streams/html/css/www.css" rel="stylesheet">
<link type="text/css" href="/streams/html/css/tables.css" rel="stylesheet">
<link type="text/css" href="/streams/html/css/content_northstar_styles.css" rel="stylesheet">
<link type="text/css" href="/streams/html/css/kc.css" rel="stylesheet"/>
</head>

<body id="jmxapi-lgop">
<div class="jmx-body">
  <!-- NLS_CHARSET=UTF-8 -->
  <div class="blue_header">
  <!-- Infosphere Streams topics header v -->
  <div class="runningheader"><!--<img src="../../com.ibm.swg.im.infosphere.streams.common.doc/images/ngibm.gif" border="0" alt="" align="top" />-->
  <!--<div style="float:right; padding-bottom:5px;">
    <image src="/streams/html/images/home_button.svg"/>
  </div>-->
  <!-- End of InfoSphere Streams topics header -->
  <div class="button_back"><a href="/external-reference/jmx/api/java/api/index.html">Streams JMX API</a></div></div>
  <div class="nav_bar"></div>
</div>

<h1 class="title topictitle1">Performing large data operations with JMX APIs</h1>
<div class="body taskbody">
<div class="abstract">
<div class="shortdesc">The <span class="keyword">Teracloud
Streams</span> JMX API uses an HTTPS implementation for transferring large data values between the client where
the application runs and the server where the <span class="keyword">JMX service</span> runs. For example, this implementation is used for client retrieval of processing element (PE)
metrics and for uploading an application when a job is submitted. 
</div>

<p class="p">To complete these operations, you must call the JMX API method to retrieve an HTTPS URI, validate
the server certificate to determine whether the <span class="keyword">Teracloud
Streams</span> server is trusted, and make the HTTP call to send or receive the data.</p>

<div class="note note border-2 ibm-border-blue-50 margin-top-1 margin-bottom-1"><span class="notetitle ibm-bold ibm-textcolor-blue-50 background-blue ibm-padding-top-1 ibm-padding-bottom-1 padding-left-1 padding-right-1">Note</span> If the value of the <span class="keyword parmname">jmx.sslOption</span> configuration property is
<kbd class="ph userinput">none</kbd>, an HTTP URI is returned and a non-encrypted connection is used to
transfer the data.
</div>
</div>
<div class="tasklabel"><h2 class="sectiontitle tasklabel ibm-h3 ibm-padding-top-1" id="taskd33777e64">Procedure</h2>
</div><ol class="ol steps ibm-colored-list ibm-textcolor-gray-80"><li class="li step stepexpand"><span class="ph cmd">Call the JMX API method to retrieve an HTTPS URI. </span> <p class="p">Several JMX API methods return an HTTPS URI for a return value. For example, the
<span class="keyword apiname">InstanceMXBean.deployApplication()</span> and <span class="keyword apiname">JobMXBean.snapshot()</span>
methods return an HTTPS URI. This HTTPS URI is the URI to which the HTTP call must be made.</p>
 <p class="p"></p>
</li>
<li class="li step stepexpand"><span class="ph cmd">Validate the  <span class="keyword">Teracloud
Streams</span> certificate to determine whether the <span class="keyword">Teracloud
Streams</span> server is trusted.</span> <p class="p"><span class="keyword">Teracloud
Streams</span> identifies itself to clients by using a self-signed certificate. Your application must validate
the certificate that it receives when it establishes the HTTPS connection to the <span class="keyword">Teracloud
Streams</span> server. It can perform this validation by comparing the certificate that it received to a known
certificate in a client truststore. You can use the streamtool exportkeystore <span class="keyword cmdname">-k
jmxhttp</span> command to generate a client truststore that contains the <span class="keyword">Teracloud
Streams</span> certificate. You can then use this truststore for the comparison. In addition, because the
<span class="keyword">Teracloud
Streams</span> certificate is not specific to a single server, you must also provide a host name verifier to
trust the certificate. </p>
</li>
<li class="li step stepexpand"><span class="ph cmd">Make the HTTP call to send or receive the data.</span> <p class="p">The documentation for the JMX API methods that return an HTTPS URI includes information about
which HTTP call must be made to complete the operation. This call must be made within <span class="ph">2 minutes</span> of retrieving the URI. Otherwise, the URI times out and is no longer
valid. This URI is only valid for a single call. Subsequent calls fail.</p>
</li>
</ol>
<div class="example">
<div class="tasklabel"><h2 class="sectiontitle tasklabel ibm-h3 ibm-padding-top-1" id="taskd33777e126">Example</h2>
</div>The following Java™ code example uses the <span class="keyword">Teracloud
Streams</span> JMX API to retrieve product log entries.
<pre class="pre codeblock ibm-textcolor-default ibm-background-neutral-white-40"><code data-clipboard-id="codeblock0">import java.io.BufferedReader;
import java.io.InputStream;
import java.io.InputStreamReader;
import java.util.HashMap;

import java.net.URL;
import javax.net.ssl.HttpsURLConnection;
import javax.net.ssl.HostnameVerifier;
import javax.net.ssl.SSLSession;

import javax.management.JMX;
import javax.management.MBeanServerConnection;
import javax.management.ObjectName;
import javax.management.remote.JMXConnector;
import javax.management.remote.JMXConnectorFactory;
import javax.management.remote.JMXServiceURL;

import com.ibm.streams.management.domain.DomainMXBean;
import com.ibm.streams.management.ObjectNameBuilder;

// javac -cp com.ibm.streams.management.jmxmp.jar:com.ibm.streams.management.mx.jar Client.java
// java -cp .:com.ibm.streams.management.jmxmp.jar:com.ibm.streams.management.mx.jar:jmxremote_optional.jar:glassfish-corba-omgapi-[version].jar:commons-cli-[version].jar 
//   Client service:jmx:jmxmp://server:9975 domainA user password TLSv1.3
// Note: It is important to include com.ibm.streams.management.jmxmp.jar in the class path before jmxremote_optional.jar
public class Client {
  public static void main(String [] args) {
    try { 
      String jmxUrl = args[0];  // use streamtool getjmxconnect to find
      String domainName = args[1];
      String user = args[2];    // use streamtool setacl to assign required permissions
      String password = args[3];
      <samp class="ph codeph">String protocol = args[4]; // use streamtool getproperty jmx.sslOption to find</samp>
            
      HashMap&lt;String, Object&gt; env = new HashMap&lt;String,Object&gt;();
      String [] creds = {user, password};
      env.put("jmx.remote.credentials", creds);
      env.put("jmx.remote.protocol.provider.pkgs", "com.ibm.streams.management");
      <samp class="ph codeph">env.put("jmx.remote.tls.enabled.protocols", protocol);</samp>
 
      JMXConnector jmxc = JMXConnectorFactory.connect(new JMXServiceURL(jmxUrl), env);
      MBeanServerConnection mbsc = jmxc.getMBeanServerConnection();

      ObjectName objName = ObjectNameBuilder.domain(domainName);
      DomainMXBean domain = JMX.newMXBeanProxy(mbsc, objName, DomainMXBean.class, true);
      String uri = domain.retrieveProductLog(null);

      // supply truststore to compare with certificate sent by server
      System.setProperty("javax.net.ssl.trustStore", ".\\streams_keystore.p12");  // use streamtool exportkeystore -k jmxhttp -p tspassword to retrieve
      System.setProperty("javax.net.ssl.trustStorePassword", "tspassword");  // password value specified on streamtool exportkeystore
 
      // if certificate matched for the domain, trust the server from which it was sent
      HostnameVerifier hv = new HostnameVerifier() {
        public boolean verify(String urlHostName, SSLSession session) {
          return true;
        }
      };
      HttpsURLConnection.setDefaultHostnameVerifier(hv);

      URL url = new URL(uri);
      HttpsURLConnection conn = (HttpsURLConnection) url.openConnection();
      conn.setRequestMethod("GET");
      conn.connect();
      InputStream  response = conn.getInputStream();

      BufferedReader reader = new BufferedReader(new InputStreamReader(response));
      String line;
      while ((line = reader.readLine()) != null) {
        System.out.println(line);
      }
      reader.close();
      response.close();
      conn.disconnect();
    }
    catch (Exception e) {
      e.printStackTrace();     
    }
 }
}</code>
</pre>
</div>
</div>
</div></body></html>
