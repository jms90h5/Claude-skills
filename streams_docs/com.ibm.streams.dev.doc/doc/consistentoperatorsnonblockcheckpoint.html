<!DOCTYPE html><html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-us" lang="en-us" data-whc_version="22.0">
    <head><link rel="shortcut icon" href="../../favicon-light.png"/><link rel="icon" href="../../favicon-light.png"/><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"/><meta name="DC.rights.owner" content="(C) Copyright 2025"/><meta name="copyright" content="(C) Copyright 2025"/><meta name="generator" content="DITA-OT"/><meta name="DC.type" content="concept"/><meta name="description" content="A stateful C++ or Java primitive operator can implement non-blocking checkpointing of operator state data to reduce the time that the tuple flow is blocked during checkpointing."/><meta name="DC.relation" content="../../com.ibm.streams.dev.doc/doc/consistentregionswritingoperators.html"/><meta name="DC.relation" content="../../com.ibm.streams.dev.doc/doc/dev-container.html"/><meta name="DC.relation" content="../../com.ibm.streams.dev.doc/doc/writingapplications.html"/><meta name="DC.relation" content="../../com.ibm.streams.dev.doc/doc/spl_features.html"/><meta name="DC.relation" content="../../com.ibm.streams.dev.doc/doc/consistentregions.html"/><meta name="DC.format" content="HTML5"/><meta name="DC.identifier" content="consistentoperatorsnonblockcheckpoint"/><meta name="DC.language" content="en-us"/>        
      <title>Implementing non-blocking checkpointing in stateful primitive operators</title><!--  Generated with Oxygen version 26.0, build number 2024012323.  --><meta name="wh-path2root" content="../../"/><meta name="wh-toc-id" content="consistentoperatorsnonblockcheckpoint-d41691e5164"/><meta name="wh-source-relpath" content="com.ibm.streams.dev.doc/doc/consistentoperatorsnonblockcheckpoint.dita"/><meta name="wh-out-relpath" content="com.ibm.streams.dev.doc/doc/consistentoperatorsnonblockcheckpoint.html"/>

    <link rel="stylesheet" type="text/css" href="../../oxygen-webhelp/app/commons.css?buildId=2024012323"/>
    <link rel="stylesheet" type="text/css" href="../../oxygen-webhelp/app/topic.css?buildId=2024012323"/>

    <script src="../../oxygen-webhelp/app/options/properties.js?buildId=20250729150623"></script>
    <script src="../../oxygen-webhelp/app/localization/strings.js?buildId=2024012323"></script>
    <script src="../../oxygen-webhelp/app/search/index/keywords.js?buildId=20250729150623"></script>
    <script defer="defer" src="../../oxygen-webhelp/app/commons.js?buildId=2024012323"></script>
    <script defer="defer" src="../../oxygen-webhelp/app/topic.js?buildId=2024012323"></script>
<link rel="stylesheet" type="text/css" href="../../oxygen-webhelp/template/cobalt.css?buildId=2024012323"/><link rel="stylesheet" type="text/css" href="../../oxygen-webhelp/template/params/args.css/cobalt.css?buildId=2024012323"/><link rel="stylesheet" type="text/css" href="../../cobalt.css"/></head>

    <body id="consistentoperatorsnonblockcheckpoint" class="wh_topic_page frmBody">
        <a href="#wh_topic_body" class="sr-only sr-only-focusable">
            Jump to main content
        </a>
        
        
        
        
       <!-- <whc:include_html href="${webhelp.fragment.header}"/>-->
        <header class="navbar navbar-default wh_header_tpc" data-whc_version="23.1">
    <div class="container-fluid">
        <div class="wh_header_flex_container_tpc navbar-nav navbar-expand-md navbar-dark"> 
            <!--<div class="wh_logo_and_publication_title_container">
                <div class="wh_logo_and_publication_title">
                    <whc:include_html href="${webhelp.fragment.before.logo_and_title}"/>-->
                    <!--
                            This component will be generated when the next parameters are specified in the transformation scenario:
                            'webhelp.logo.image' and 'webhelp.logo.image.target.url'.
                            See: http://oxygenxml.com/doc/versions/17.1/ug-editor/#topics/dita_webhelp_output.html.
                    -->
                    <!--<whc:webhelp_logo class="d-none d-sm-block"/>
                    <whc:webhelp_publication_title/>
                    <whc:include_html href="${webhelp.fragment.after.logo_and_title}"/>
                </div>-->
                
                <!-- The menu button for mobile devices is copied in the output only when the 'webhelp.show.top.menu' parameter is set to 'yes' -->
                
            <!--</div>-->

            <div class="wh_logo_tpc">
                <a href="/index.html"><img width="200px" height="24px" src="/media/home_button.svg" style="margin-top: 1em;"/></a>
        </div>
        <!-- Search form -->
        <div class=" wh_search_input navbar-form wh_main_page_search search " role="form">
            
            
            
            
            
            <!--<div class="wh_welcome">
                <whc:include_html href="${webhelp.fragment.welcome}"/>
            </div>    -->      
            <form id="searchForm" method="get" role="search" action="../../search.html"><div><input type="search" placeholder="Search " class="wh_search_textfield" id="textToSearch" name="searchQuery" aria-label="Search query" required="required"/><button type="submit" class="wh_search_button" aria-label="Search"><span class="search_input_text">Search</span></button></div></form>
            
            
            
            
        </div>
    </div>
</div></header>

        
         
        

        
        <div class="container-fluid" id="wh_topic_container">
            <div class="row">

                <nav class="wh_tools d-print-none navbar-expand-md" aria-label="Tools">
                    
                    <div data-tooltip-position="bottom" class=" wh_breadcrumb "><ol class="d-print-none"><li><span class="home"><a href="../../index.html"><span>Home</span></a></span></li><li><div class="topicref" data-id="dev-container"><div class="title"><a href="../../com.ibm.streams.dev.doc/doc/dev-container.html">Developing</a><div class="wh-tooltip"><p class="shortdesc">Learn about different Teracloud Streams tools and features to write, compile, run, and    test streams applications.</p></div></div></div></li><li><div class="topicref" data-id="writingapplications"><div class="title"><a href="../../com.ibm.streams.dev.doc/doc/writingapplications.html">Developing <span class="keyword">stream applications</span></a><div class="wh-tooltip"><p class="shortdesc">Try out tutorials and explore details about stream application development, SPL features,     and best practices.</p></div></div></div></li><li><div class="topicref" data-id="spl_features"><div class="title"><a href="../../com.ibm.streams.dev.doc/doc/spl_features.html">SPL features</a><div class="wh-tooltip"><p class="shortdesc"><span class="keyword">Teracloud® 					Streams</span> provides features and functions to help you write your applications to fulfill your         business needs.</p></div></div></div></li><li><div class="topicref" data-id="consistentregions"><div class="title"><a href="../../com.ibm.streams.dev.doc/doc/consistentregions.html">Consistent regions</a><div class="wh-tooltip"><p class="shortdesc">Because of business requirements, some applications require that all tuples in an application are processed at least once. You can use a consistent region in your <span class="keyword">stream applications</span> to avoid data loss due to software or hardware failure and meet your requirements for at-least-once processing.</p></div></div></div></li><li><div class="topicref" data-id="consistentregionswritingoperators"><div class="title"><a href="../../com.ibm.streams.dev.doc/doc/consistentregionswritingoperators.html">Writing operators that support consistent regions</a><div class="wh-tooltip"><p class="shortdesc">When you develop operators that are included in consistent regions, you must follow programming guidelines and use certain interfaces provided by <span class="keyword">Teracloud® 					Streams</span>.</p></div></div></div></li><li class="active"><div class="topicref" data-id="consistentoperatorsnonblockcheckpoint"><div class="title"><a href="../../com.ibm.streams.dev.doc/doc/consistentoperatorsnonblockcheckpoint.html">Implementing non-blocking checkpointing in stateful primitive operators</a><div class="wh-tooltip"><p class="shortdesc">A stateful C++ or Java primitive operator can implement non-blocking checkpointing of operator state data to reduce the time that the tuple flow is blocked during checkpointing.</p></div></div></div></li></ol></div>
                    
                    
                    
                    <div class="wh_right_tools">
                        <button class="wh_hide_highlight" aria-label="Toggle search highlights" title="Toggle search highlights"></button>
                        <button class="webhelp_expand_collapse_sections" data-next-state="collapsed" aria-label="Collapse sections" title="Collapse sections"></button>
                        
                        
                        <!-- External resource link -->
                        
                        
                        <div class=" wh_print_link print d-none d-md-inline-block "><button onClick="window.print()" title="Print this page" aria-label="Print this page"></button></div>
                        
                        <!-- Expand/Collapse publishing TOC 
                             The menu button for mobile devices is copied in the output only when the publication TOC is available
                        -->
                        <button type="button" data-target="#wh_publication_toc" id="wh_toc_button" data-toggle="collapse" class="custom-toggler navbar-toggler collapsed wh_toggle_button navbar-light" aria-expanded="false" aria-label="Toggle publishing table of content" aria-controls="wh_publication_toc">
                            <span class="navbar-toggler-icon"></span>
                        </button>
                    </div>
                    
                </nav>
            </div>
            
            
            
            
            <div class="wh_content_area">
                <div class="row">
                    
                        
                        <nav id="wh_publication_toc" class="collapse col-lg-3 col-md-3 col-sm-12 d-md-block d-print-none" aria-label="Table of Contents Container">
                            <div class=" wh_publication_toc " data-tooltip-position="right"><span class="expand-button-action-labels"><span id="button-expand-action" role="button" aria-label="Expand"></span><span id="button-collapse-action" role="button" aria-label="Collapse"></span><span id="button-pending-action" role="button" aria-label="Pending"></span></span><ul role="tree" aria-label="Table of Contents"><li role="treeitem" aria-expanded="false"><div data-tocid="kc_welcome-d41691e179" class="topicref" data-id="kc_welcome" data-state="not-ready"><span role="button" tabindex="0" aria-labelledby="button-expand-action kc_welcome-d41691e179-link" class="wh-expand-btn"></span><div class="title"><a href="../../com.ibm.streams.welcome.doc/doc/kc-homepage.html" id="kc_welcome-d41691e179-link">Welcome</a><div class="wh-tooltip"><p class="shortdesc">Learn about the core capabilities of <span class="keyword">Teracloud® Streams</span>, its architecture, and key concepts.</p></div></div></div></li><li role="treeitem" aria-expanded="false"><div data-tocid="installstreams-container-d41691e427" class="topicref" data-id="installstreams-container" data-state="not-ready"><span role="button" tabindex="0" aria-labelledby="button-expand-action installstreams-container-d41691e427-link" class="wh-expand-btn"></span><div class="title"><a href="../../com.ibm.streams.install.doc/doc/installstreams-container.html" id="installstreams-container-d41691e427-link">Installing</a><div class="wh-tooltip"><p class="shortdesc"><span class="ph">Use this information to install, upgrade, and uninstall the <span class="keyword">Teracloud® 					Streams</span> product.</span></p></div></div></div></li><li role="treeitem" aria-expanded="false"><div data-tocid="ibminfospherestreams-containercfg-d41691e1501" class="topicref" data-id="ibminfospherestreams-containercfg" data-state="not-ready"><span role="button" tabindex="0" aria-labelledby="button-expand-action ibminfospherestreams-containercfg-d41691e1501-link" class="wh-expand-btn"></span><div class="title"><a href="../../com.ibm.streams.cfg.doc/doc/ibminfospherestreams-containercfg.html" id="ibminfospherestreams-containercfg-d41691e1501-link">Configuring</a><div class="wh-tooltip"><p class="shortdesc">Create a basic or an enterprise domain which is a single point for configuring and       managing common resources, security, and instances.</p></div></div></div></li><li role="treeitem" aria-expanded="false"><div data-tocid="containeradmin-d41691e2701" class="topicref" data-id="containeradmin" data-state="not-ready"><span role="button" tabindex="0" aria-labelledby="button-expand-action containeradmin-d41691e2701-link" class="wh-expand-btn"></span><div class="title"><a href="../../com.ibm.streams.admin.doc/doc/ibminfospherestreams-containeradmin.html" id="containeradmin-d41691e2701-link">Administering</a><div class="wh-tooltip"><p class="shortdesc">Administer the product by using the <span class="keyword">Teracloud® 					Streams</span> graphical user interface, APIs, or the <code class="ph codeph">streamtool</code> command-line   interface.</p></div></div></div></li><li role="treeitem" aria-expanded="true"><div data-tocid="dev-container-d41691e3979" class="topicref" data-id="dev-container" data-state="expanded"><span role="button" tabindex="0" aria-labelledby="button-collapse-action dev-container-d41691e3979-link" class="wh-expand-btn"></span><div class="title"><a href="../../com.ibm.streams.dev.doc/doc/dev-container.html" id="dev-container-d41691e3979-link">Developing</a><div class="wh-tooltip"><p class="shortdesc">Learn about different Teracloud Streams tools and features to write, compile, run, and    test streams applications.</p></div></div></div><ul role="group" class="navbar-nav nav-list"><li role="treeitem" aria-expanded="false"><div data-tocid="streaming_application_basics-d41691e3994" class="topicref" data-id="streaming_application_basics" data-state="not-ready"><span role="button" tabindex="0" aria-labelledby="button-expand-action streaming_application_basics-d41691e3994-link" class="wh-expand-btn"></span><div class="title"><a href="../../com.ibm.streams.dev.doc/doc/streaming_application_basics.html" id="streaming_application_basics-d41691e3994-link">Development concepts</a><div class="wh-tooltip"><p class="shortdesc">Development of stream applications consists of several components such as operators,         streams, tuples, Streams Processing Language, toolkits, and         more.</p></div></div></div></li><li role="treeitem" aria-expanded="true"><div data-tocid="writingapplications-d41691e4218" class="topicref" data-id="writingapplications" data-state="expanded"><span role="button" tabindex="0" aria-labelledby="button-collapse-action writingapplications-d41691e4218-link" class="wh-expand-btn"></span><div class="title"><a href="../../com.ibm.streams.dev.doc/doc/writingapplications.html" id="writingapplications-d41691e4218-link">Developing <span class="keyword">stream applications</span></a><div class="wh-tooltip"><p class="shortdesc">Try out tutorials and explore details about stream application development, SPL features,     and best practices.</p></div></div></div><ul role="group" class="navbar-nav nav-list"><li role="treeitem" aria-expanded="false"><div data-tocid="tut-container-d41691e4232" class="topicref" data-id="tut-container" data-state="not-ready"><span role="button" tabindex="0" aria-labelledby="button-expand-action tut-container-d41691e4232-link" class="wh-expand-btn"></span><div class="title"><a href="../../com.ibm.streams.tutorials.doc/doc/tut-container.html" id="tut-container-d41691e4232-link">Tutorials</a><div class="wh-tooltip"><p class="shortdesc">Learn how to create simple <span class="keyword">stream applications</span> by completing the tutorials.</p></div></div></div></li><li role="treeitem" aria-expanded="false"><div data-tocid="compiler-container-d41691e4508" class="topicref" data-id="compiler-container" data-state="not-ready"><span role="button" tabindex="0" aria-labelledby="button-expand-action compiler-container-d41691e4508-link" class="wh-expand-btn"></span><div class="title"><a href="../../com.ibm.streams.dev.doc/doc/compiler-container.html" id="compiler-container-d41691e4508-link">Compiling <span class="keyword">stream applications</span></a><div class="wh-tooltip"><p class="shortdesc">The <span class="keyword">Streams Processing Language (SPL)</span> Compiler is called <span class="ph"><span class="keyword cmdname">sc</span></span> and is included with the <span class="keyword">Teracloud® Streams</span> installation package. You compile SPL to create files to run on your <span class="keyword">Teracloud Streams instance</span>.</p></div></div></div></li><li role="treeitem"><div data-tocid="applicationbundle-d41691e4676" class="topicref" data-id="applicationbundle" data-state="leaf"><span role="button" class="wh-expand-btn"></span><div class="title"><a href="../../com.ibm.streams.dev.doc/doc/applicationbundle.html" id="applicationbundle-d41691e4676-link">Application bundle files</a><div class="wh-tooltip"><p class="shortdesc">An <span class="keyword">application bundle file</span> is a single, relocatable file that contains all the artifacts that are needed to run your application. You submit a <span class="keyword">application bundle file</span> to run on an instance.</p></div></div></div></li><li role="treeitem" aria-expanded="true"><div data-tocid="spl_features-d41691e4693" class="topicref" data-id="spl_features" data-state="expanded"><span role="button" tabindex="0" aria-labelledby="button-collapse-action spl_features-d41691e4693-link" class="wh-expand-btn"></span><div class="title"><a href="../../com.ibm.streams.dev.doc/doc/spl_features.html" id="spl_features-d41691e4693-link">SPL features</a><div class="wh-tooltip"><p class="shortdesc"><span class="keyword">Teracloud® 					Streams</span> provides features and functions to help you write your applications to fulfill your         business needs.</p></div></div></div><ul role="group" class="navbar-nav nav-list"><li role="treeitem"><div data-tocid="compileargs-d41691e4708" class="topicref" data-id="compileargs" data-state="leaf"><span role="button" class="wh-expand-btn"></span><div class="title"><a href="../../com.ibm.streams.dev.doc/doc/compileargs.html" id="compileargs-d41691e4708-link">Specifying compile-time arguments</a><div class="wh-tooltip"><p class="shortdesc">The SPL compiler, <span class="keyword cmdname">sc</span> command, supports arguments that are passed in at compile time.</p></div></div></div></li><li role="treeitem"><div data-tocid="submissionvalues-d41691e4722" class="topicref" data-id="submissionvalues" data-state="leaf"><span role="button" class="wh-expand-btn"></span><div class="title"><a href="../../com.ibm.streams.dev.doc/doc/submissionvalues.html" id="submissionvalues-d41691e4722-link">Submission-time values</a><div class="wh-tooltip"><p class="shortdesc">SPL supports submission-time values, which are arguments that are specified at the time of application launch.</p></div></div></div></li><li role="treeitem"><div data-tocid="creating-secure-app-configs-dev-d41691e4733" class="topicref" data-id="creating-secure-app-configs-dev" data-state="leaf"><span role="button" class="wh-expand-btn"></span><div class="title"><a href="../../com.ibm.streams.dev.doc/doc/creating-secure-app-configs-dev.html" id="creating-secure-app-configs-dev-d41691e4733-link">Using application configuration objects to access secure data</a><div class="wh-tooltip"><p class="shortdesc">Use application configuration objects to securely access sensitive configuration         items from your <span class="keyword">Teracloud® 					Streams</span> environment.</p></div></div></div></li><li role="treeitem" aria-expanded="false"><div data-tocid="udpdev-d41691e4749" class="topicref" data-id="udpdev" data-state="not-ready"><span role="button" tabindex="0" aria-labelledby="button-expand-action udpdev-d41691e4749-link" class="wh-expand-btn"></span><div class="title"><a href="../../com.ibm.streams.dev.doc/doc/udpdev.html" id="udpdev-d41691e4749-link">User-defined parallelism</a><div class="wh-tooltip"><p class="shortdesc">User-defined parallelism, available through the <code class="ph codeph">@parallel</code>             annotation, allows you to easily take advantage of data-parallelism in your <span class="keyword">Teracloud® 					Streams</span> applications. </p></div></div></div></li><li role="treeitem" aria-expanded="true"><div data-tocid="consistentregions-d41691e5019" class="topicref" data-id="consistentregions" data-state="expanded"><span role="button" tabindex="0" aria-labelledby="button-collapse-action consistentregions-d41691e5019-link" class="wh-expand-btn"></span><div class="title"><a href="../../com.ibm.streams.dev.doc/doc/consistentregions.html" id="consistentregions-d41691e5019-link">Consistent regions</a><div class="wh-tooltip"><p class="shortdesc">Because of business requirements, some applications require that all tuples in an application are processed at least once. You can use a consistent region in your <span class="keyword">stream applications</span> to avoid data loss due to software or hardware failure and meet your requirements for at-least-once processing.</p></div></div></div><ul role="group" class="navbar-nav nav-list"><li role="treeitem"><div data-tocid="consist-reg-ex-prim-d41691e5034" class="topicref" data-id="consist-reg-ex-prim" data-state="leaf"><span role="button" class="wh-expand-btn"></span><div class="title"><a href="../../com.ibm.streams.dev.doc/doc/consistentprimitiveoperators.html" id="consist-reg-ex-prim-d41691e5034-link">Defining the scope of consistent regions with primitive operators</a><div class="wh-tooltip"><p class="shortdesc">When the <code class="ph codeph">@consistent</code> annotation is applied to a primitive          operator, the annotation indicates that the operator and all downstream operators of that          operator participate in a consistent region.</p></div></div></div></li><li role="treeitem"><div data-tocid="consist-reg-ex-comp-d41691e5048" class="topicref" data-id="consist-reg-ex-comp" data-state="leaf"><span role="button" class="wh-expand-btn"></span><div class="title"><a href="../../com.ibm.streams.dev.doc/doc/consistentcompositeoperators.html" id="consist-reg-ex-comp-d41691e5048-link">Composite operators and consistent regions</a><div class="wh-tooltip"><p class="shortdesc">When the <code class="ph codeph">@consistent</code> annotation is applied to a composite    operator, the annotation indicates that the composite operator and the <dfn class="term">downstream     operators</dfn> of the composite operator participate in a single consistent    region.</p></div></div></div></li><li role="treeitem"><div data-tocid="consist-reg-ex-auton-d41691e5065" class="topicref" data-id="consist-reg-ex-auton" data-state="leaf"><span role="button" class="wh-expand-btn"></span><div class="title"><a href="../../com.ibm.streams.dev.doc/doc/consistentscope.html" id="consist-reg-ex-auton-d41691e5065-link">Limiting the scope of consistent regions</a><div class="wh-tooltip"><p class="shortdesc">By using the <code class="ph codeph">@autonomous</code> annotation, you can limit the scope of a consistent region. When you add the <code class="ph codeph">@autonomous</code> annotation to an operator that is in a consistent region, it is excluded from the consistent region and the operator resorts back to its behavior before it was part of a consistent region.</p></div></div></div></li><li role="treeitem"><div data-tocid="consistentoperatorsupport-d41691e5082" class="topicref" data-id="consistentoperatorsupport" data-state="leaf"><span role="button" class="wh-expand-btn"></span><div class="title"><a href="../../com.ibm.streams.dev.doc/doc/consistentoperatorsupport.html" id="consistentoperatorsupport-d41691e5082-link">Operators that support consistent regions</a><div class="wh-tooltip"><p class="shortdesc">An operator might not support all of its possible parameters when it is in a consistent region.</p></div></div></div></li><li role="treeitem"><div data-tocid="jobcontrolplane-d41691e5093" class="topicref" data-id="jobcontrolplane" data-state="leaf"><span role="button" class="wh-expand-btn"></span><div class="title"><a href="../../com.ibm.streams.dev.doc/doc/jobcontrolplane.html" id="jobcontrolplane-d41691e5093-link"><span class="keyword apiname">JobControlPlane</span> operator</a><div class="wh-tooltip"><p class="shortdesc">The <span class="keyword apiname">JobControlPlane</span> operator is added to an application graph to   coordinate control information between operators. You must add a    <span class="keyword apiname">JobControlPlane</span> operator to each application that includes a consistent   region.</p></div></div></div></li><li role="treeitem" aria-expanded="true"><div data-tocid="consistentregionswritingoperators-d41691e5112" class="topicref" data-id="consistentregionswritingoperators" data-state="expanded"><span role="button" tabindex="0" aria-labelledby="button-collapse-action consistentregionswritingoperators-d41691e5112-link" class="wh-expand-btn"></span><div class="title"><a href="../../com.ibm.streams.dev.doc/doc/consistentregionswritingoperators.html" id="consistentregionswritingoperators-d41691e5112-link">Writing operators that support consistent regions</a><div class="wh-tooltip"><p class="shortdesc">When you develop operators that are included in consistent regions, you must follow programming guidelines and use certain interfaces provided by <span class="keyword">Teracloud® 					Streams</span>.</p></div></div></div><ul role="group" class="navbar-nav nav-list"><li role="treeitem"><div data-tocid="consistent-stateful-ops-d41691e5128" class="topicref" data-id="consistent-stateful-ops" data-state="leaf"><span role="button" class="wh-expand-btn"></span><div class="title"><a href="../../com.ibm.streams.dev.doc/doc/consistentstatefuloperators.html" id="consistent-stateful-ops-d41691e5128-link">Stateful primitive operators that participate in consistent regions</a><div class="wh-tooltip"><p class="shortdesc">To have primitive operators that restore their internal states during a reset of a consistent region, use the <span class="keyword apiname">StateHandler</span> interface.</p></div></div></div></li><li role="treeitem"><div data-tocid="consistentprimitiveoperatorswithwindows-d41691e5142" class="topicref" data-id="consistentprimitiveoperatorswithwindows" data-state="leaf"><span role="button" class="wh-expand-btn"></span><div class="title"><a href="../../com.ibm.streams.dev.doc/doc/consistentprimitiveoperatorswithwindows.html" id="consistentprimitiveoperatorswithwindows-d41691e5142-link">Primitive C++ operators with windows in consistent regions</a><div class="wh-tooltip"><p class="shortdesc">To checkpoint and reset the state of operators that use the C++  windowing library in a consistent region, operators must call window state management functions.</p></div></div></div></li><li role="treeitem"><div data-tocid="consistent-start-ops-d41691e5153" class="topicref" data-id="consistent-start-ops" data-state="leaf"><span role="button" class="wh-expand-btn"></span><div class="title"><a href="../../com.ibm.streams.dev.doc/doc/consistentstartoperators.html" id="consistent-start-ops-d41691e5153-link">Primitive operators that start consistent regions</a><div class="wh-tooltip"><p class="shortdesc">Any primitive operator that starts a consistent region and that replays its submitted tuples upon a failure must acquire tuple submission permits to pause and resume tuple submission during a checkpoint or a reset.</p></div></div></div></li><li role="treeitem" class="active"><div data-tocid="consistentoperatorsnonblockcheckpoint-d41691e5164" class="topicref" data-id="consistentoperatorsnonblockcheckpoint" data-state="leaf"><span role="button" class="wh-expand-btn"></span><div class="title"><a href="../../com.ibm.streams.dev.doc/doc/consistentoperatorsnonblockcheckpoint.html" id="consistentoperatorsnonblockcheckpoint-d41691e5164-link">Implementing non-blocking checkpointing in stateful primitive operators</a><div class="wh-tooltip"><p class="shortdesc">A stateful C++ or Java primitive operator can implement non-blocking checkpointing of operator state data to reduce the time that the tuple flow is blocked during checkpointing.</p></div></div></div></li></ul></li></ul></li><li role="treeitem" aria-expanded="false"><div data-tocid="views_developing-d41691e5175" class="topicref" data-id="views_developing" data-state="not-ready"><span role="button" tabindex="0" aria-labelledby="button-expand-action views_developing-d41691e5175-link" class="wh-expand-btn"></span><div class="title"><a href="../../com.ibm.streams.dev.doc/doc/views_developing.html" id="views_developing-d41691e5175-link">Views</a><div class="wh-tooltip"><p class="shortdesc">To make streaming data available to external programs, your SPL application must create         at least one view. A view defines the set of attributes that can appear in a specific         viewable data stream.</p></div></div></div></li><li role="treeitem" aria-expanded="false"><div data-tocid="eventtime-developing-d41691e5218" class="topicref" data-id="eventtime-developing" data-state="not-ready"><span role="button" tabindex="0" aria-labelledby="button-expand-action eventtime-developing-d41691e5218-link" class="wh-expand-btn"></span><div class="title"><a href="../../com.ibm.streams.dev.doc/doc/eventtime-developing.html" id="eventtime-developing-d41691e5218-link">Event time</a><div class="wh-tooltip"><p class="shortdesc">Event time is a simple model which supports streams processing where time is not derived from the system time of the machine <span class="keyword">Teracloud® 					Streams</span> is running on, but from a time value associated with each tuple. In a graph enabled for event time, tuples have an attribute which holds their time value. The time value for each tuple enables operations such as grouping tuples with a time value falling within specified time intervals, and running aggregate calculations on the group. </p></div></div></div></li><li role="treeitem"><div data-tocid="loggingandtracingoptionsforsplapplicationdevelopers-d41691e5280" class="topicref" data-id="loggingandtracingoptionsforsplapplicationdevelopers" data-state="leaf"><span role="button" class="wh-expand-btn"></span><div class="title"><a href="../../com.ibm.streams.dev.doc/doc/logtraceoptionsforappdevs.html" id="loggingandtracingoptionsforsplapplicationdevelopers-d41691e5280-link">Logging and tracing options</a><div class="wh-tooltip"><p class="shortdesc">SPL application developers can write messages to product log and trace files. Log and trace files help administrators, instance owners, application developers, and the support team to identify, diagnose, and resolve problems with the <span class="keyword">Teracloud® 					Streams</span> and applications.</p></div></div></div></li></ul></li><li role="treeitem" aria-expanded="false"><div data-tocid="bestpractices-d41691e5297" class="topicref" data-id="bestpractices" data-state="not-ready"><span role="button" tabindex="0" aria-labelledby="button-expand-action bestpractices-d41691e5297-link" class="wh-expand-btn"></span><div class="title"><a href="../../com.ibm.streams.dev.doc/doc/str_bestpractices.html" id="bestpractices-d41691e5297-link">Best practices</a><div class="wh-tooltip"><p class="shortdesc">Use these tips to write operators that perform effectively in their application, and in other applications.</p></div></div></div></li><li role="treeitem" aria-expanded="false"><div data-tocid="perfrecforsplapplicationprogrammers-d41691e5577" class="topicref" data-id="perfrecforsplapplicationprogrammers" data-state="not-ready"><span role="button" tabindex="0" aria-labelledby="button-expand-action perfrecforsplapplicationprogrammers-d41691e5577-link" class="wh-expand-btn"></span><div class="title"><a href="../../com.ibm.streams.dev.doc/doc/perf_rec_spl_app_programmers.html" id="perfrecforsplapplicationprogrammers-d41691e5577-link">Performance recommendations</a><div class="wh-tooltip"><p class="shortdesc">You can use these performance options and recommendations to improve your <span class="keyword">stream application</span>.</p></div></div></div></li></ul></li><li role="treeitem" aria-expanded="false"><div data-tocid="creatingnativefunctions-d41691e5698" class="topicref" data-id="creatingnativefunctions" data-state="not-ready"><span role="button" tabindex="0" aria-labelledby="button-expand-action creatingnativefunctions-d41691e5698-link" class="wh-expand-btn"></span><div class="title"><a href="../../com.ibm.streams.dev.doc/doc/creatingnativefunctions.html" id="creatingnativefunctions-d41691e5698-link"><span class="ph">Developing native functions</span></a><div class="wh-tooltip"><p class="shortdesc">Extend SPL's computational capabilities by creating native functions     written in C++ or Java.</p></div></div></div></li><li role="treeitem" aria-expanded="false"><div data-tocid="developing_operators-d41691e5772" class="topicref" data-id="developing_operators" data-state="not-ready"><span role="button" tabindex="0" aria-labelledby="button-expand-action developing_operators-d41691e5772-link" class="wh-expand-btn"></span><div class="title"><a href="../../com.ibm.streams.dev.doc/doc/developing_operators.html" id="developing_operators-d41691e5772-link">Developing custom operators</a><div class="wh-tooltip"><p class="shortdesc">Create custom operators if shipped toolkits do not provide the necessary logic or   behavior needed for your <span class="keyword">stream applications</span>.</p></div></div></div></li><li role="treeitem" aria-expanded="false"><div data-tocid="creating_toolkits-d41691e7044" class="topicref" data-id="creating_toolkits" data-state="not-ready"><span role="button" tabindex="0" aria-labelledby="button-expand-action creating_toolkits-d41691e7044-link" class="wh-expand-btn"></span><div class="title"><a href="../../com.ibm.streams.dev.doc/doc/creating_toolkits.html" id="creating_toolkits-d41691e7044-link">Developing custom toolkits</a><div class="wh-tooltip"><p class="shortdesc">Bundle and reuse custom functions and operators across several <span class="keyword">stream applications</span> by creating custom toolkits.</p></div></div></div></li><li role="treeitem"><div data-tocid="enabling-streams-application-service-d41691e7457" class="topicref" data-id="enabling-streams-application-service" data-state="leaf"><span role="button" class="wh-expand-btn"></span><div class="title"><a href="../../com.ibm.streams.dev.doc/doc/enabling-streams-data-exchange.html" id="enabling-streams-application-service-d41691e7457-link">Enabling Streams data exchange</a><div class="wh-tooltip"><p class="shortdesc"><span class="keyword">Teracloud® 					Streams</span> provides a data exchange REST API for inserting and retrieving tuples within a job to             easily integrate with other data services and external applications. Stream applications             can enable the data exchange feature by using one or more Endpoint             operators.</p></div></div></div></li><li role="treeitem" aria-expanded="false"><div data-tocid="spldebugger-container-d41691e7472" class="topicref" data-id="spldebugger-container" data-state="not-ready"><span role="button" tabindex="0" aria-labelledby="button-expand-action spldebugger-container-d41691e7472-link" class="wh-expand-btn"></span><div class="title"><a href="../../com.ibm.streams.dev.doc/doc/spldebugger-container.html" id="spldebugger-container-d41691e7472-link">Debugging <span class="keyword">stream applications</span></a><div class="wh-tooltip"><p class="shortdesc">Debug stream applications using the interactive, command line-based <span class="keyword">Streams Debugger</span> (<code class="ph codeph">sdb</code>).</p></div></div></div></li></ul></li><li role="treeitem" aria-expanded="false"><div data-tocid="troubleshootingforproduct-d41691e8087" class="topicref" data-id="troubleshootingforproduct" data-state="not-ready"><span role="button" tabindex="0" aria-labelledby="button-expand-action troubleshootingforproduct-d41691e8087-link" class="wh-expand-btn"></span><div class="title"><a href="../../com.ibm.streams.pd.doc/doc/ts_parent.html" id="troubleshootingforproduct-d41691e8087-link">Troubleshooting</a><div class="wh-tooltip"><p class="shortdesc">Resolve problems with <span class="keyword">Teracloud® Streams</span> using the troubleshooting tools provided with the product as well as the resources             offered by Teracloud Support.</p></div></div></div></li><li role="treeitem" aria-expanded="false"><div data-tocid="reference-container-d41691e60879" class="topicref" data-id="reference-container" data-state="not-ready"><span role="button" tabindex="0" aria-labelledby="button-expand-action reference-container-d41691e60879-link" class="wh-expand-btn"></span><div class="title"><a href="../../com.ibm.streams.ref.doc/doc/reference-container.html" id="reference-container-d41691e60879-link">Reference</a><div class="wh-tooltip"><p class="shortdesc">Find details on the SPL language, toolkits, APIs, commands, and more.</p></div></div></div></li><li role="treeitem"><div data-tocid="glossary-d41691e72254" class="topicref" data-id="glossary" data-state="leaf"><span role="button" class="wh-expand-btn"></span><div class="title"><a href="../../com.ibm.streams.glossary.doc/doc/glossary_streams.html" id="glossary-d41691e72254-link">Glossary</a><div class="wh-tooltip"><p class="shortdesc">Use this glossary to find terms and definitions for <span class="keyword">Teracloud® 					Streams</span>.</p></div></div></div></li></ul></div>
                        </nav>
                        
                    
                    
                    <div class="col-lg-9 col-md-9 col-sm-12" id="wh_topic_body">
                        
                        <div class=" wh_topic_content body "><main role="main"><article class="- topic/topic concept/concept topic concept" role="article" aria-labelledby="ariaid-title1">
<h1 class="- topic/title title topictitle1" id="ariaid-title1">Implementing non-blocking checkpointing in stateful primitive operators</h1>

<div class="- topic/body concept/conbody body conbody"><p class="- topic/shortdesc shortdesc">A stateful C++ or Java primitive operator can implement non-blocking checkpointing of operator state data to reduce the time that the tuple flow is blocked during checkpointing.</p>
        
<p class="- topic/p p">When a consistent state of a consistent region is established, the tuple flow is temporarily blocked until the operators in the consistent region are drained and checkpointed. With non-blocking checkpointing, the tuple flow can be resumed while an internal SPL Runtime thread checkpoints operator state data in the background. </p>
<div class="- topic/p p">By default, a stateful operator in a consistent region that implements the SPL <span class="+ topic/keyword pr-d/apiname keyword apiname">StateHandler</span> interface is checkpointed in a blocking manner:<ol class="- topic/ol ol">
<li class="- topic/li li">The tuple flow is blocked.</li>
<li class="- topic/li li">The SPL Runtime invokes the operator's <code class="+ topic/ph pr-d/codeph ph codeph">StateHandler::drain()</code> callback function.</li>
<li class="- topic/li li">The SPL Runtime invokes the operator's <code class="+ topic/ph pr-d/codeph ph codeph">StateHandler::checkpoint()</code> callback function.</li>
<li class="- topic/li li">The tuple flow is resumed.</li>
</ol>
</div>
<div class="- topic/p p">If non-blocking checkpointing is enabled for an operator, checkpointing of operator state data is done as follows:<ol class="- topic/ol ol">
<li class="- topic/li li">The tuple flow is blocked.</li>
<li class="- topic/li li">The SPL Runtime invokes the operator's <code class="+ topic/ph pr-d/codeph ph codeph">StateHandler::drain()</code> callback function.</li>
<li class="- topic/li li">The SPL Runtime invokes the operator's <code class="+ topic/ph pr-d/codeph ph codeph">StateHandler::prepareForNonBlockingCheckpoint()</code> callback function.</li>
<li class="- topic/li li">The tuple flow is resumed. Meanwhile the SPL Runtime delegates an internal thread to execute the operator’s <code class="+ topic/ph pr-d/codeph ph codeph">StateHandler::checkpoint()</code> callback function in the background. Background checkpointing is internally tracked by the SPL Runtime.</li>
<li class="- topic/li li">The background thread finishes checkpointing the operator state. </li>
</ol>With non-blocking checkpointing, tuple processing can overlap with checkpointing, which reduces the blocking time of the tuple flow.</div>
<div class="- topic/p p">To enable non-blocking checkpointing, primitive operators must implement these functions:<ul class="- topic/ul ul">
<li class="- topic/li li">The operator implementation must call the <code class="+ topic/ph pr-d/codeph ph codeph">ConsistentRegionContext::enableNonBlockingCheckpoint()</code> function in the operator's constructor.</li>
<li class="- topic/li li">The operator must implement the <code class="+ topic/ph pr-d/codeph ph codeph">StateHandler::prepareForNonBlockingCheckpoint()</code> and <code class="+ topic/ph pr-d/codeph ph codeph">StateHandler::checkpoint()</code> callback functions. </li>
</ul></div>
<p class="- topic/p p">The <code class="+ topic/ph pr-d/codeph ph codeph">StateHandler::prepareForNonBlockingCheckpoint()</code> function is called after the <code class="+ topic/ph pr-d/codeph ph codeph">StateHandler::drain()</code> function. The <code class="+ topic/ph pr-d/codeph ph codeph">StateHandler::prepareForNonBlockingCheckpoint()</code> function prepares the operator state in a certain way so that later it can be checkpointed by a <code class="+ topic/ph pr-d/codeph ph codeph">StateHandler::checkpoint()</code> callback while new tuples are being processed. Note that the processing of new tuples usually requires reading and updating the latest version of the operator state, and background checkpointing requires reading the version of the operator state at the time when <code class="+ topic/ph pr-d/codeph ph codeph">StateHandler::prepareForNonBlockingCheckpoint()</code> is called.</p>
<p class="- topic/p p">With the <code class="+ topic/ph pr-d/codeph ph codeph">StateHandler::prepareForNonBlockingCheckpoint()</code> and <code class="+ topic/ph pr-d/codeph ph codeph">StateHandler::checkpoint()</code> callback interface, an operator can implement non-blocking checkpointing in various ways. One simple approach is to make a copy of the operator state in <code class="+ topic/ph pr-d/codeph ph codeph">StateHandler::prepareForNonBlockingCheckpoint()</code> and checkpoint that copy of the operator state in <code class="+ topic/ph pr-d/codeph ph codeph">StateHandler::checkpoint()</code>. This way, background checkpointing reads the copied operator state data, while tuple processing reads and updates the original copy of the state. Thus, both activities can make progress concurrently without any synchronization with each other. Another approach is to serialize the operator state into a memory buffer (such as <code class="+ topic/ph pr-d/codeph ph codeph">SPL::NativeByteBuffer</code>) in <code class="+ topic/ph pr-d/codeph ph codeph">StateHandler::prepareForNonBlockingCheckpoint()</code> and to checkpoint the serialized data in <code class="+ topic/ph pr-d/codeph ph codeph">StateHandler::checkpoint()</code>.</p>
<p class="- topic/p p">As an example, suppose the operator has a vector of strings as its state. It can implement the <code class="+ topic/ph pr-d/codeph ph codeph">StateHandler::prepareForNonBlockingCheckpoint()</code> and <code class="+ topic/ph pr-d/codeph ph codeph">StateHandler::checkpoint()</code> callbacks as follows.</p>
<div class="- topic/p p">This code snippet is the <code class="+ topic/ph pr-d/codeph ph codeph">MyOp_h.cgt</code> file of the operator implementation:<pre class="+ topic/pre pr-d/codeblock pre codeblock scale-80"><code>// in MyOp_h.cgt file
&lt;%
  # use Code Generation API to check if the operator is used in a Consistent Region
   my $isInConsistentRegion = 
     $model-&gt;getContext()-&gt;getOptionalContext("ConsistentRegion");
   my @includes;
   if ($isInConsistentRegion) {
     push @includes, "#include &lt;SPL/Runtime/Operator/State/StateHandler.h&gt;";
   }
   SPL::CodeGen::headerPrologue($model, \@includes);
%&gt;
#include &lt;vector&gt;
#include &lt;string&gt;
#include &lt; SPL/Runtime/Serialization/NativeByteBuffer.h &gt;
class MY_OPERATOR : public MY_BASE_OPERATOR, public StateHandler {
public:
    MY_OPERATOR();
    ~MY_OPERATOR();

    virtual void process(Punctuation const &amp; punct, uint32_t port);
    virtual void process(Tuple const &amp; tuple, uint32_t port);

    // StateHandler callback interface
    virtual void checkpoint(Checkpoint &amp; ckpt);
    virtual void reset(Checkpoint &amp; ckpt);
    virtual void resetToInitialState();
    virtual void prepareForNonBlockingCheckpoint(int64_t id);
private:
SPL::Mutex _mutex; // mutex lock to guard concurrent access to operator state
Std::vector&lt;std::string&gt; _myState;     // a vector of strings as operator state
SPL::NativeByteBuffer _serializedState; // serialization buffer
}
</code></pre></div>
<div class="- topic/p p">This code snippet is the <code class="+ topic/ph pr-d/codeph ph codeph">MyOp_cpp.cgt</code> file of the operator implementation:<pre class="+ topic/pre pr-d/codeblock pre codeblock scale-80"><code>// in MyOp_cpp.cgt file
&lt;%
    # use Code Generation API to check if the operator is used in a Consistent Region
    my $isInConsistentRegion = $model-&gt;getContext()-&gt;getOptionalContext("ConsistentRegion");
%&gt;
// Constructor
MY_OPERATOR::MY_OPERATOR() {
    &lt;% if ($isInConsistentRegion) {%&gt;  
    ConsistentRegionContext * crContext = 
    static_cast&lt;ConsistentRegionContext *&gt;(getContext().getOptionalContext(CONSISTENT_REGION));
    // call ConsistentRegionContext::enableNonBlockingCheckpoint() in operator constructor
    crContext-&gt;enableNonBlockingCheckpoint();
    &lt;% } %&gt;    
}

// process() function for tuple processing
void MY_OPERATOR::process(Tuple const &amp; tuple, uint32_t port)
{
    AutoPortMutex apm (_mutex, *this);
    // manipulate operator state (i.e. _myState) based on incoming tuple
    std::string newStirng = functionFoo(tuple);
    _myState.push_back(newString);
}

// Function to prepare operator state for non-blocking checkpointing
void MY_OPERATOR::prepareForNonBlockingCheckpoint(int64_t id)
{
    // serialize the state
    _serializedState &lt;&lt; _myState;
}

// Function to checkpoint operator state
// This function can be executed while process() is called for processing new tuples
void MY_OPERATOR::checkpoint(Checkpoint &amp; ckpt)
{
    // Note that no locking on _mutex is needed since this function does not access _myState
    // checkpoint the serialized state
    ckpt.addCharSequence((char const *)_serializedState.getPtr(), 
        (uint32_t)_serializedState.getContentSize());
    // reset the cursor of serialization buffer to the beginning
    _serializedState.setICursor(0);
}

// Function to restore operator state
void MY_OPERATOR::reset(Checkpoint &amp; ckpt)
{
AutoMutex am(_mutex);
    // restore _myState from checkpoint
    ckpt &gt;&gt; _myState;
    // reset the cursor of serialization buffer to the beginning
    _serializedState.setICursor(0);
}

// Function to reset operator to initial state
void MY_OPERATOR::resetToInitialState()
{
    AutoMutex am(_mutex);
    _myState.clear();
    _serializedState.setICursor(0);
}
</code></pre></div>
<p class="- topic/p p">The approach shown in the example is simple to implement, and it has a performance advantage over the blocking checkpointing implementation. In the blocking checkpointing implementation, the vector of strings is directly checkpointed in <code class="+ topic/ph pr-d/codeph ph codeph">StateHandler::checkpoint()</code>, and both data serialization and I/O time contribute to the time the tuple flow is blocked. With the non-blocking checkpointing implementation, however, the blocking time is only the serialization time, which should be significantly shorter. </p>
<p class="- topic/p p">Besides the simple copy approach, there are other ways to implement non-blocking checkpointing. One alternative is to use copy-on-write data structures. </p>
<p class="- topic/p p">Operators that enable non-blocking checkpointing and operators that do not enable non-blocking checkpointing can be put in the same consistent region. In this case, the tuple flow of the consistent region is blocked when the region starts draining, and it is resumed when all the non-blocking checkpointing operators have completed their <code class="+ topic/ph pr-d/codeph ph codeph">StateHandler::prepareForNonBlockingCheckpoint()</code> callbacks and all the blocking checkpointing operators have completed their <code class="+ topic/ph pr-d/codeph ph codeph">StateHandler::checkpoint()</code> callbacks. </p>
<p class="- topic/p p">If an operator calls the <code class="+ topic/ph pr-d/codeph ph codeph">ConsistentRegionContext::enableNonBlockingCheckpoint()</code> function in its constructor while having logic state variables defined, its <code class="+ topic/ph pr-d/codeph ph codeph">StateHandler::prepareForNonBlockingCheckpoint()</code> and <code class="+ topic/ph pr-d/codeph ph codeph">StateHandler::checkpoint()</code> callbacks are still invoked by the SPL Runtime during draining the consistent region, but non-blocking checkpointing does not take effect at run time. That means, the tuple flow is resumed only after the <code class="+ topic/ph pr-d/codeph ph codeph">StateHandler::checkpoint()</code> callback is completed. </p>
<p class="- topic/p p">If an operator that is configured with checkpointing is in an autonomous region, the <code class="+ topic/ph pr-d/codeph ph codeph">StateHandler::prepareForNonBlockingCheckpoint()</code> callback is ignored</p>
<section class="- topic/section section"><h2 class="- topic/title title sectiontitle">Implementing start operators that support non-blocking checkpointing</h2>

<div class="- topic/p p">An operator that starts a consistent region can implement the <code class="+ topic/ph pr-d/codeph ph codeph">StateHandler::regionCheckpointed()</code> callback function to get notified by the SPL Runtime when all the operators in the consistent region were successfully drained and checkpointed, including those operators that perform non-blocking checkpointing. Within the <code class="+ topic/ph pr-d/codeph ph codeph">StateHandler::regionCheckpointed()</code> callback function, the start operator can implement logic such as:<ul class="- topic/ul ul">
<li class="- topic/li li">Printing log messages, for example to record that a consistent state was established for the consistent region.</li>
<li class="- topic/li li">Cleaning up certain resources, for example purging any buffered input tuples received before this drain, because those tuples were reflected in the persisted state of the consistent region and are no longer needed for replay upon recovery from a failure.</li>
</ul></div>
<p class="- topic/p p">A start operator that starts an operator-driven consistent region initiates the draining of the
                region by calling either the
                    <code class="+ topic/ph pr-d/codeph ph codeph">ConsistentRegionContext::makeConsistent()</code> or the
                    <code class="+ topic/ph pr-d/codeph ph codeph">ConsistentRegionContext::makeConsistentNonBlocking()</code>
                function.</p>
<p class="- topic/p p">When any thread in a start operator calls the <code class="+ topic/ph pr-d/codeph ph codeph">ConsistentRegionContext::makeConsistent()</code> function to initiate the draining of the consistent region, the calling thread is blocked on this call. The <code class="+ topic/ph pr-d/codeph ph codeph">ConsistentRegionContext::makeConsistent()</code> function returns true when all operators in the consistent region were drained and checkpointed, including any operator with non-blocking checkpointing enabled. The <code class="+ topic/ph pr-d/codeph ph codeph">ConsistentRegionContext::makeConsistent()</code> function returns false when there is a shutdown request or the region is reset due to failure. This means that if the start operator uses the <code class="+ topic/ph pr-d/codeph ph codeph">ConsistentRegionContext::makeConsistent()</code> function, the tuple flow is blocked until the whole consistent region is checkpointed, so that any operator that has non-blocking checkpointing enabled effectively falls back to blocking checkpointing at run time.</p>
<p class="- topic/p p">Alternatively, a start operator can call the <code class="+ topic/ph pr-d/codeph ph codeph">ConsistentRegionContext::makeConsistentNonBlocking()</code> API to initiate the draining of the consistent region and allow true non-blocking checkpointing at run time. The <code class="+ topic/ph pr-d/codeph ph codeph"> ConsistentRegionContext::makeConsistentNonBlocking()</code> function returns an Enum object <code class="+ topic/ph pr-d/codeph ph codeph">DrainResult</code> with a value of either <code class="+ topic/ph pr-d/codeph ph codeph">CHECKPOINT_PENDING</code>, <code class="+ topic/ph pr-d/codeph ph codeph">COMPLETED</code>, or <code class="+ topic/ph pr-d/codeph ph codeph">FAILED</code>. Returning <code class="+ topic/ph pr-d/codeph ph codeph">CHECKPOINT_PENDING</code> means that the <code class="+ topic/ph pr-d/codeph ph codeph">StateHandler::drain()</code> callback is complete for all operators that do blocking checkpointing, and the <code class="+ topic/ph pr-d/codeph ph codeph">StateHandler::prepareForNonBlockingCheckpoint()</code> callback is complete for all operators that do non-blocking checkpointing. In this case, the tuple flow can be resumed while the pending non-blocking checkpointing is ongoing. When all the pending non-blocking checkpointing has finished, the SPL Runtime calls the start operator’s <code class="+ topic/ph pr-d/codeph ph codeph">StateHandler::regionCheckpointed()</code> function. The <code class="+ topic/ph pr-d/codeph ph codeph">ConsistentRegionContext::makeConsistentNonBlocking()</code> function can return <code class="+ topic/ph pr-d/codeph ph codeph">COMPLETED</code> in case all operators in the consistent region have been drained and checkpointed, or return <code class="+ topic/ph pr-d/codeph ph codeph">FAILED</code> if there is a shutdown request or the region is reset due to failure.</p>
<p class="- topic/p p">Operator developers should use the
                    <code class="+ topic/ph pr-d/codeph ph codeph">ConsistentRegionContext::makeConsistentNonBlocking()</code> function
                in favor of the <code class="+ topic/ph pr-d/codeph ph codeph">ConsistentRegionContext::makeConsistent()</code> function
                to achieve non-blocking checkpointing of an operator-driven consistent region. The
                    <code class="+ topic/ph pr-d/codeph ph codeph">ConsistentRegionContext::makeConsistent()</code> function is still
                available in <span class="- topic/keyword keyword"><span class="- topic/tm tm">Teracloud<span class="- topic/tmmark tmmark ">®</span></span> Streams</span> mainly for maintaining backwards compatibility with previous product
                versions.</p>
</section>
</div>
</article></main></div>
                        
                        
                        
                        
                        <whc:webhelp_feedback xmlns="" xmlns:whc="http://www.oxygenxml.com/webhelp/components" class="d-print-none"></whc:webhelp_feedback>
                        
                        
                    </div>
                    
                </div>
            </div>
            
            
            
        </div> 
        <footer class="navbar navbar-default wh_footer" data-whc_version="23.1"> 

  <!--<whc:include_html href="${webhelp.fragment.footer}"/>-->
  
  <div class="footer-container">
    
    <div class="grid-container">
        
        
        <div class="hf"><h4 class="head">Teracloud Streams</h4>
          
          <p class="text-gray">Revolutionizing real-time data analytics with advanced tools, AI integration, and unparalleled expertise.</p></div>
        
        <div class="hs"><h4 class="head">Quick Links</h4>
          <a href="https://streams.teracloud.com" target="_blank" rel="noopener noreferrer" class="links blue">Official Website</a><br/>
            <a href="https://teracloud.com" target="_blank" rel="noopener noreferrer" class="links blue">About Teracloud</a><br/>
            <a href="https://teracloud.com/privacy" target="_blank" rel="noopener noreferrer" class="links blue">Privacy Policy</a>
          </div>
        
        <div class="ht"><h4 class="head">Contact Us</h4>
          
          <a href="mailto:info.streams@teracloud.com" class="text-gray2 links">info.streams@teracloud.com</a></div>
        
        
      
      <div class="bottom-row">© 2025 Teracloud. All rights reserved.</div></div>
  </div>

</footer>
        
        <div id="go2top" class="d-print-none">
            <span class="oxy-icon oxy-icon-up"></span>
        </div>
        
        <!-- The modal container for images -->
        <div id="modal_img_large" class="modal">
            <span class="close oxy-icon oxy-icon-remove"></span>
            <!-- Modal Content (The Image) -->
            <img class="modal-content" id="modal-img" alt=""/>
            <!-- Modal Caption (Image Text) -->
            <div id="caption"></div>
        </div>
        
        
        
    </body>
</html>